local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")

if _G.SV_ANTIKILL_LOADED then return end
_G.SV_ANTIKILL_LOADED = true

local THEME_COLOR = Color3.fromRGB(200, 0, 0)
local BG_COLOR = Color3.fromRGB(20, 20, 20)
local GLASS_TRANSPARENCY = 0.2

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SVAntiKillUI_Fixed"
ScreenGui.Parent = CoreGui
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local function createLiquidFrame(name, parent, size, position)
    local frame = Instance.new("Frame")
    frame.Name = name
    frame.Parent = parent
    frame.Size = size
    frame.Position = position
    frame.BackgroundColor3 = BG_COLOR
    frame.BackgroundTransparency = GLASS_TRANSPARENCY
    frame.BorderSizePixel = 0
    frame.ClipsDescendants = true
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 16)
    corner.Parent = frame
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = THEME_COLOR
    stroke.Thickness = 2
    stroke.Transparency = 0.3
    stroke.Parent = frame
    
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.new(1,1,1)),
        ColorSequenceKeypoint.new(1, Color3.new(0.5,0.5,0.5))
    }
    gradient.Rotation = 45
    gradient.Parent = frame
    
    return frame
end

local LoadingFrame = createLiquidFrame("LoadingFrame", ScreenGui, UDim2.new(0, 300, 0, 150), UDim2.new(0.5, -150, 0.5, -75))
LoadingFrame.BackgroundTransparency = 0

local LoadingTitle = Instance.new("TextLabel")
LoadingTitle.Parent = LoadingFrame
LoadingTitle.Text = "SV ANTIKILL"
LoadingTitle.Size = UDim2.new(1, 0, 0.5, 0)
LoadingTitle.BackgroundTransparency = 1
LoadingTitle.TextColor3 = THEME_COLOR
LoadingTitle.Font = Enum.Font.GothamBold
LoadingTitle.TextSize = 24

local BarBG = Instance.new("Frame")
BarBG.Parent = LoadingFrame
BarBG.BackgroundColor3 = Color3.fromRGB(40,40,40)
BarBG.Size = UDim2.new(0.8, 0, 0.1, 0)
BarBG.Position = UDim2.new(0.1, 0, 0.7, 0)
Instance.new("UICorner", BarBG).CornerRadius = UDim.new(1, 0)

local BarFill = Instance.new("Frame")
BarFill.Parent = BarBG
BarFill.BackgroundColor3 = THEME_COLOR
BarFill.Size = UDim2.new(1, 0, 1, 0)
Instance.new("UICorner", BarFill).CornerRadius = UDim.new(1, 0)

local MainFrame = createLiquidFrame("MainFrame", ScreenGui, UDim2.new(0, 250, 0, 300), UDim2.new(0.5, -125, 0.5, -150))
MainFrame.Visible = false

local Title = Instance.new("TextLabel")
Title.Parent = MainFrame
Title.Text = "SV ANTIKILL"
Title.Size = UDim2.new(1, -60, 0, 40)
Title.Position = UDim2.new(0, 10, 0, 5)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.new(1,1,1)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18

local function createSysBtn(text, pos, callback)
    local btn = Instance.new("TextButton")
    btn.Parent = MainFrame
    btn.Text = text
    btn.Size = UDim2.new(0, 30, 0, 30)
    btn.Position = pos
    btn.BackgroundColor3 = Color3.fromRGB(0,0,0)
    btn.BackgroundTransparency = 0.5
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.GothamBold
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
    
    btn.MouseButton1Click:Connect(callback)
    return btn
end

createSysBtn("X", UDim2.new(1, -35, 0, 5), function()
    _G.SV_ANTIKILL_LOADED = nil
    ScreenGui:Destroy()
end)

local MinimizedState = false
createSysBtn("-", UDim2.new(1, -70, 0, 5), function()
    MinimizedState = not MinimizedState
    
    if MinimizedState then
        for _, v in pairs(MainFrame:GetChildren()) do
            if v:IsA("GuiObject") and v.Name ~= "DragHandle" then v.Visible = false end
        end
        MainFrame.Size = UDim2.new(0, 50, 0, 50)
        MainFrame.BackgroundTransparency = 0.5
        MainFrame.UICorner.CornerRadius = UDim.new(1, 0)
    else
        MainFrame.Size = UDim2.new(0, 250, 0, 300)
        MainFrame.BackgroundTransparency = GLASS_TRANSPARENCY
        MainFrame.UICorner.CornerRadius = UDim.new(0, 16)
        for _, v in pairs(MainFrame:GetChildren()) do
            if v:IsA("GuiObject") then v.Visible = true end
        end
    end
end)

local ActivateBtn = Instance.new("TextButton")
ActivateBtn.Parent = MainFrame
ActivateBtn.Name = "ActivateBtn"
ActivateBtn.Text = "ATIVAR CUBO"
ActivateBtn.Size = UDim2.new(0.8, 0, 0, 50)
ActivateBtn.Position = UDim2.new(0.1, 0, 0.4, 0)
ActivateBtn.BackgroundColor3 = THEME_COLOR
ActivateBtn.TextColor3 = Color3.new(1,1,1)
ActivateBtn.Font = Enum.Font.GothamBlack
ActivateBtn.TextSize = 16
Instance.new("UICorner", ActivateBtn).CornerRadius = UDim.new(0, 12)
Instance.new("UIStroke", ActivateBtn).Color = Color3.new(1,1,1)

local DragHandle = Instance.new("TextButton")
DragHandle.Name = "DragHandle"
DragHandle.Parent = MainFrame
DragHandle.Size = UDim2.new(0, 40, 0, 40)
DragHandle.Position = UDim2.new(1, -40, 1, -40)
DragHandle.BackgroundTransparency = 1
DragHandle.Text = "â¤¡"
DragHandle.TextColor3 = Color3.fromRGB(150,150,150)
DragHandle.TextSize = 20

local dragging, dragInput, dragStart, startPos
DragHandle.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

DragHandle.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

local CubeContainer = Instance.new("Frame")
CubeContainer.Parent = ScreenGui
CubeContainer.Size = UDim2.new(0, 200, 0, 200)
CubeContainer.Position = UDim2.new(0.5, -100, 0.5, -100)
CubeContainer.BackgroundTransparency = 1
CubeContainer.Visible = false

local Viewport = Instance.new("ViewportFrame")
Viewport.Parent = CubeContainer
Viewport.Size = UDim2.new(1, 0, 1, 0)
Viewport.BackgroundTransparency = 1
Viewport.CurrentCamera = Instance.new("Camera")

local CubePart = Instance.new("Part")
CubePart.Material = Enum.Material.Neon
CubePart.Color = THEME_COLOR
CubePart.Size = Vector3.new(4, 4, 4)
CubePart.Parent = Viewport

local Camera = Viewport.CurrentCamera
Camera.CFrame = CFrame.new(Vector3.new(0, 0, 8), Vector3.new(0, 0, 0))
Camera.Parent = Viewport

local InfoText = Instance.new("TextLabel")
InfoText.Parent = CubeContainer
InfoText.Text = "CLIQUE 2 VEZES\nPARA SAIR"
InfoText.Size = UDim2.new(1, 0, 1, 0)
InfoText.BackgroundTransparency = 1
InfoText.TextColor3 = Color3.new(1,1,1)
InfoText.TextStrokeTransparency = 0
InfoText.Font = Enum.Font.GothamBold
InfoText.TextSize = 14
InfoText.ZIndex = 5

local CubeClickArea = Instance.new("TextButton")
CubeClickArea.Parent = CubeContainer
CubeClickArea.Size = UDim2.new(1, 0, 1, 0)
CubeClickArea.BackgroundTransparency = 1
CubeClickArea.Text = ""
CubeClickArea.ZIndex = 6

local isRunning = false
RunService.RenderStepped:Connect(function()
    if isRunning and CubeContainer.Visible then
        CubePart.CFrame = CubePart.CFrame * CFrame.Angles(0.02, 0.02, 0.02)
        local hue = tick() % 5 / 5
        CubePart.Color = Color3.fromHSV(hue, 0.8, 1)
        if MinimizedState then
            MainFrame.UIStroke.Color = Color3.fromHSV(hue, 1, 1)
        end
    end
end)

ActivateBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    CubeContainer.Visible = true
    isRunning = true
end)

local lastClickTime = 0
CubeClickArea.MouseButton1Click:Connect(function()
    local currentTime = tick()
    if currentTime - lastClickTime < 0.5 then
        isRunning = false
        CubeContainer.Visible = false
        MainFrame.Visible = true
    end
    lastClickTime = currentTime
end)

task.wait(1.5)
LoadingFrame.Visible = false
MainFrame.Visible = true
