local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")

local uiName = "SV_AntiKill_V2_FixedZoom"
local existing = CoreGui:FindFirstChild(uiName)
if existing then
    existing:Destroy()
end
_G.SV_ANTIKILL_LOADED = true

local THEME_COLOR = Color3.fromRGB(255, 40, 40)
local BG_COLOR = Color3.fromRGB(15, 15, 15)

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = uiName
ScreenGui.Parent = CoreGui
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.Size = UDim2.new(0, 240, 0, 210) 
MainFrame.Position = UDim2.new(0.5, -120, 0.5, -105)
MainFrame.BackgroundColor3 = BG_COLOR
MainFrame.BackgroundTransparency = 0.1
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = THEME_COLOR
MainStroke.Thickness = 2
MainStroke.Transparency = 0.2
MainStroke.Parent = MainFrame

local ContentContainer = Instance.new("Frame")
ContentContainer.Name = "Content"
ContentContainer.Parent = MainFrame
ContentContainer.Size = UDim2.new(1, 0, 1, 0)
ContentContainer.BackgroundTransparency = 1

local Title = Instance.new("TextLabel")
Title.Parent = ContentContainer
Title.Text = "SV ANTIKILL"
Title.Size = UDim2.new(1, -50, 0, 35)
Title.Position = UDim2.new(0, 15, 0, 5)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.new(1, 1, 1)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 20

local CloseBtn = Instance.new("TextButton")
CloseBtn.Parent = ContentContainer
CloseBtn.Text = "×"
CloseBtn.Size = UDim2.new(0, 30, 0, 30)
CloseBtn.Position = UDim2.new(1, -35, 0, 5)
CloseBtn.BackgroundTransparency = 1
CloseBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
CloseBtn.Font = Enum.Font.GothamMedium
CloseBtn.TextSize = 24
CloseBtn.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
    _G.SV_ANTIKILL_LOADED = nil
end)

local MinBtn = Instance.new("TextButton")
MinBtn.Parent = ContentContainer
MinBtn.Text = "-"
MinBtn.Size = UDim2.new(0, 30, 0, 30)
MinBtn.Position = UDim2.new(1, -65, 0, 5)
MinBtn.BackgroundTransparency = 1
MinBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
MinBtn.Font = Enum.Font.GothamMedium
MinBtn.TextSize = 24

local ActivateBtn = Instance.new("TextButton")
ActivateBtn.Parent = ContentContainer
ActivateBtn.Text = "ATIVAR CUBO"
ActivateBtn.Size = UDim2.new(0.85, 0, 0, 45)
ActivateBtn.Position = UDim2.new(0.075, 0, 0.25, 0)
ActivateBtn.BackgroundColor3 = THEME_COLOR
ActivateBtn.TextColor3 = Color3.new(1, 1, 1)
ActivateBtn.Font = Enum.Font.GothamBold
ActivateBtn.TextSize = 16
Instance.new("UICorner", ActivateBtn).CornerRadius = UDim.new(0, 8)

local SliderLabel = Instance.new("TextLabel")
SliderLabel.Parent = ContentContainer
SliderLabel.Text = "TAMANHO DO CUBO"
SliderLabel.Size = UDim2.new(1, 0, 0, 20)
SliderLabel.Position = UDim2.new(0, 0, 0.55, 0)
SliderLabel.BackgroundTransparency = 1
SliderLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
SliderLabel.Font = Enum.Font.GothamBold
SliderLabel.TextSize = 12

local SliderBG = Instance.new("Frame")
SliderBG.Parent = ContentContainer
SliderBG.Size = UDim2.new(0.85, 0, 0, 6)
SliderBG.Position = UDim2.new(0.075, 0, 0.68, 0)
SliderBG.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Instance.new("UICorner", SliderBG).CornerRadius = UDim.new(1, 0)

local SliderFill = Instance.new("Frame")
SliderFill.Parent = SliderBG
SliderFill.Size = UDim2.new(0.5, 0, 1, 0) 
SliderFill.BackgroundColor3 = THEME_COLOR
SliderFill.BorderSizePixel = 0
Instance.new("UICorner", SliderFill).CornerRadius = UDim.new(1, 0)

local SliderBtn = Instance.new("TextButton")
SliderBtn.Parent = SliderBG
SliderBtn.Size = UDim2.new(1, 0, 2, 0)
SliderBtn.Position = UDim2.new(0, 0, -0.5, 0)
SliderBtn.BackgroundTransparency = 1
SliderBtn.Text = ""

local RestoreBtn = Instance.new("TextButton")
RestoreBtn.Parent = MainFrame
RestoreBtn.Size = UDim2.new(1, 0, 1, 0)
RestoreBtn.BackgroundTransparency = 1
RestoreBtn.Text = ""
RestoreBtn.Visible = false
RestoreBtn.ZIndex = 10

local DragHandle = Instance.new("TextButton")
DragHandle.Parent = ContentContainer
DragHandle.Size = UDim2.new(0, 30, 0, 30)
DragHandle.Position = UDim2.new(1, -30, 1, -30)
DragHandle.BackgroundTransparency = 1
DragHandle.Text = "⤡"
DragHandle.TextColor3 = Color3.fromRGB(100, 100, 100)
DragHandle.TextSize = 18

local dragging, dragInput, dragStart, startPos
local function updateDrag(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

DragHandle.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)

DragHandle.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then updateDrag(input) end
end)

local CubeContainer = Instance.new("Frame")
CubeContainer.Parent = ScreenGui
CubeContainer.Size = UDim2.new(0, 200, 0, 200)
CubeContainer.Position = UDim2.new(0.5, -100, 0.5, -100)
CubeContainer.BackgroundTransparency = 1
CubeContainer.Visible = false

local Viewport = Instance.new("ViewportFrame")
Viewport.Parent = CubeContainer
Viewport.Size = UDim2.new(1, 0, 1, 0)
Viewport.BackgroundTransparency = 1
Viewport.CurrentCamera = Instance.new("Camera")

local CubePart = Instance.new("Part")
CubePart.Material = Enum.Material.Neon
CubePart.Color = THEME_COLOR
-- Tamanho inicial
local initialSize = 8
CubePart.Size = Vector3.new(initialSize, initialSize, initialSize)
CubePart.Parent = Viewport

local Camera = Viewport.CurrentCamera
-- Distância inicial da câmera baseada no tamanho
local initialDist = initialSize * 1.8 
Camera.CFrame = CFrame.new(Vector3.new(0, 0, initialDist), Vector3.new(0, 0, 0))
Camera.Parent = Viewport

local InfoText = Instance.new("TextLabel")
InfoText.Parent = CubeContainer
InfoText.Text = "CLIQUE DUPLO PRA VOLTAR"
InfoText.Size = UDim2.new(1, 0, 1, 0)
InfoText.BackgroundTransparency = 1
InfoText.TextColor3 = Color3.new(1, 1, 1)
InfoText.TextStrokeTransparency = 0.5
InfoText.Font = Enum.Font.GothamBold
InfoText.TextSize = 14
InfoText.ZIndex = 5

local CubeClickArea = Instance.new("TextButton")
CubeClickArea.Parent = CubeContainer
CubeClickArea.Size = UDim2.new(1, 0, 1, 0)
CubeClickArea.BackgroundTransparency = 1
CubeClickArea.Text = ""
CubeClickArea.ZIndex = 6

local isSliderDragging = false
local function updateSlider(input)
    local pos = input.Position.X
    local sliderX = SliderBG.AbsolutePosition.X
    local sliderW = SliderBG.AbsoluteSize.X
    local pct = math.clamp((pos - sliderX) / sliderW, 0, 1)
    
    SliderFill.Size = UDim2.new(pct, 0, 1, 0)
    
    -- Calcula o novo tamanho do cubo (de 2 a 20)
    local newSize = 2 + (pct * 18)
    CubePart.Size = Vector3.new(newSize, newSize, newSize)
    
    -- Calcula a nova distância da câmera para manter o enquadramento
    -- A distância é proporcional ao tamanho do cubo
    local newDist = newSize * 1.8
    Camera.CFrame = CFrame.new(Vector3.new(0, 0, newDist), Vector3.new(0, 0, 0))
end

SliderBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isSliderDragging = true
        updateSlider(input)
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then isSliderDragging = false end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if isSliderDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        updateSlider(input)
    end
end)

local isMinimized = false
local function ToggleMinimize()
    isMinimized = not isMinimized
    if isMinimized then
        ContentContainer.Visible = false
        MainCorner.CornerRadius = UDim.new(1, 0)
        TweenService:Create(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back), {Size = UDim2.new(0, 50, 0, 50)}):Play()
        RestoreBtn.Visible = true
    else
        RestoreBtn.Visible = false
        TweenService:Create(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back), {Size = UDim2.new(0, 240, 0, 210)}):Play()
        task.wait(0.2)
        MainCorner.CornerRadius = UDim.new(0, 12)
        ContentContainer.Visible = true
    end
end

MinBtn.MouseButton1Click:Connect(ToggleMinimize)
RestoreBtn.MouseButton1Click:Connect(ToggleMinimize)

local isRunning = false
RunService.RenderStepped:Connect(function()
    if isRunning and CubeContainer.Visible then
        CubePart.CFrame = CubePart.CFrame * CFrame.Angles(0.02, 0.02, 0.02)
        local hue = tick() % 5 / 5
        CubePart.Color = Color3.fromHSV(hue, 0.8, 1)
        if isMinimized then
            MainStroke.Color = Color3.fromHSV(hue, 1, 1)
        end
    end
end)

ActivateBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    CubeContainer.Visible = true
    isRunning = true
end)

local lastClickTime = 0
CubeClickArea.MouseButton1Click:Connect(function()
    local currentTime = tick()
    if currentTime - lastClickTime < 0.5 then
        isRunning = false
        CubeContainer.Visible = false
        MainFrame.Visible = true
    else
        local t = TweenService:Create(InfoText, TweenInfo.new(0.1), {TextTransparency = 0.5})
        t:Play()
        t.Completed:Wait()
        TweenService:Create(InfoText, TweenInfo.new(0.1), {TextTransparency = 0}):Play()
    end
    lastClickTime = currentTime
end)
